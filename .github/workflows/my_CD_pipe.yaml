name: Continous Deployment

on:
    push:
        branches:
            - main

    workflow_dispatch:

jobs:
    testing:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2
              with:
                  fetch-depth: 0
            - uses: actions/setup-python@v2

            - name: Install Poetry deps
              run: |
                  curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -
                  source $HOME/.poetry/env
                  poetry install

            - name: Run tox testing
              run: poetry run tox
